# Iterative-Closest-Point
Алгоритм совмещения 3D облаков точек, написанный в Unity, часть проекта по созданию человеко-машинного интерфейса (ЧМИ).

## Краткое описание сути алгоритма ICP
Алгоритм ICP (Iterative Closest Points) является основным среди методов «выравнивания» трёхмерных моделей, основанных на использовании исключительно геометрических характеристик. Под выравниванием понимается определение геометрического преобразования, наилучшим относительно нормы L2 образом связывающего два данных набора (облака) точек в R3. Алгоритм широко используется для регистрации данных, получаемых с помощью SD-сканеров.

## Проблема
Для совмещения облака точек, полученного сканером с моделью в интерфесе ЧМИ, для нахождения ошибки позиционирования и её учёта при адльнейшей работе, необходим алгоритм, способный произвести подобную операцию с объектами в Unity. 
Готовых реализаций трёхмерного ICP алгоритма на C# найти не удалось, не говоря уже специльно под Unity.

## Описание разработанного алгоритма
- Для работы с матрицами использовалась библиотека Math.Net.Numerics.LinearAlgebra, для построения KD-дерева – Supercluster.KDTree
- Написанный на C# скрипт получает на вход два объекта, из которых берёт компонент Mesh, содержащий полигональную сетку и вершины полигонов (вертексы), которые используются в качестве облака точек. На выходе программа перемещает объект, который должен быть совмещён с эталонным, поворачивая его и изменяя его позицию.

### Опиание кода
**Алгоритм выполнен в одном скрипте icpalg.cs**
- В методе Start(), который выполняется перед первым кадром при запуске программы, программа получает компоненты Mesh обоих объектов. Таким образом данная операция выполняется единожды при запуске программы, это позволяет избежать выполнения дорогостоящей операции каждый кадр.
- В методе Update(), который выполняется каждый кадр, производится перевод массива координат вертексов в матрицу библиотеки Math.Net.Numerics.LinearAlgebra для дальнейшей работы с ними.
- Весь алгоритм ICP реализован в методе ICP_run, в котором производится поиск ближайших соседей при помощи библиотечного алгоритма KD-дерева, центроидов (среднее арифметическое облака точек одного объекта), расчёт кватерниона поворота и вектора перемещения. После чего, найденные перемещения применяются к объекту среды Unity.

## Картинки c примерами работы
### Совмещение кубов
<img src="https://sun9-46.userapi.com/s/v1/if2/LLsv5_LFFbyqOSZd8DEgOhJGJdxTSaIbCeje6lycFvSHupRNIcyuKeuZxoDVFulGWcbuWSP3BQ2Pqggv2MNvCVhv.jpg?size=763x526&quality=96&type=album" width="550" height="380">

_____

### Совмещение капсулей
<img src="https://sun9-43.userapi.com/s/v1/if2/_eFutWb_v7CNqR6dWzqBD53X7nUM2-PdEBPzdD3EHNNgE-dpmXZ9D4DlY0Z1MPccq6ulb75bAIDqIVD1LY3908hp.jpg?size=831x557&quality=96&type=album" width="550" height="380">

_____

### Совмещение цилиндров
<img src="https://sun9-79.userapi.com/s/v1/if2/xrvuB3qikhuyMZMkGpV2PBjxGlALb_O0TN7xHm9v36MCFFxX8hTh_wZ4qr_iagi812Kef2HmeaPOJ-MbrVq16cuK.jpg?size=851x546&quality=96&type=album" width="550" height="380">

_____

### Совмещение сложного объекта - дерева
<img src="https://sun9-49.userapi.com/s/v1/if2/zHEetqbeMc90_5f594uZcLGFLnUGiUF-vcs6lhy57XjnpaIQipgiArSVff_DUIWXLLCFQoEik1yqXHQhkn4iN8eD.jpg?size=843x535&quality=96&type=album" width="550" height="380">

_____

## Инструкция по установке
- Установить библиотеки Math.Net.Numerics.LinearAlgebra, Supercluster.KDTree
- Скачать файл Iterative-Closest-Point\ICP\Assets\Scripts\icpalg.cs
- Импортировать файл в свой проект
- Повесить файл на объект - менеджер и внести в соответсвующие поля ссылки на Transform объектов
- Запустить сцену
- Нажимая галочку startICP в скрипте менеджера, производить итерации и смотреть на результат
